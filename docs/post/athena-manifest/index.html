<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>AWS Athena manifest - adams code foo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="keywords" content="">
  <link rel="canonical" href="https://advincze.github.io/post/athena-manifest/">

  
  

  
  

  
  

  <link rel="stylesheet" type="text/css" href="https://advincze.github.io//css/combined-min.css">
  

</head>
<body class="">

<div class="site-wrap">
  <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="https://advincze.github.io/" class="site-title">adams code foo</a>
      <nav class="site-nav right">
      <a href="https://advincze.github.io//about/">About</a>
<a href="https://advincze.github.io//tags/">Tags</a>
<a href="https://advincze.github.io//contact/">Contact</a>
</form>

      </nav>
      <div class="clearfix"></div>
    </div>
  </div>
</header>

  <div class="post p2 p-responsive wrap" role="main">
    <div class="measure">
      <div class="post-header mb2">
        <h1 class="py2">AWS Athena manifest</h1>
        <span class="post-meta">Oct 11, 2020  by advincze </span><br>
        
      </div>

      <article class="post-content">
      <p>Athena allows you to process data using sql that is stored in s3. Usually you would specify an s3 path (bucket + prefix) below which you store the objects that belong to the table. Sometimes the location of your data does not adhere to this convention.  The objects might be in different locations, or you would want to include some objects to a table or partition. For these cases an s3 symlink inventory can be used.</p>
<p>Let&rsquo;s say you have multiple objects in a single bucket and you only want to process one of them:</p>
<h4 id="create-manifest">create manifest</h4>
<p>You need an object called <code>symlink.txt</code> in s3 containing a list of the objects that belong to the table. The object should contain one s3 location per line like this:</p>
<p><code>s3://mymanifestbucket/prefix123/symlink.txt</code>:</p>
<pre><code>s3://mybucket/foo/bar.parquet
s3://otherbucket/baz/qux.parquet
</code></pre><h4 id="create-athena-table">create athena table:</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">EXTERNAL</span> <span style="color:#66d9ef">TABLE</span> foo(
  id string,
  foo float
)
<span style="color:#66d9ef">ROW</span> FORMAT SERDE 
    <span style="color:#e6db74">&#39;org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe&#39;</span> 
STORED <span style="color:#66d9ef">AS</span> INPUTFORMAT 
    <span style="color:#e6db74">&#39;org.apache.hadoop.hive.ql.io.SymlinkTextInputFormat&#39;</span>
<span style="color:#66d9ef">LOCATION</span> <span style="color:#e6db74">&#39;s3://mymanifestbucket/prefix123/symlink.txt&#39;</span>
</code></pre></div>
      </article>

       
      <p class="post-meta">Tags:&nbsp;
        
            
            <a href="https://advincze.github.io//tags/aws">aws</a>
        
            ,&nbsp;
            <a href="https://advincze.github.io//tags/athena">athena</a>
        
            ,&nbsp;
            <a href="https://advincze.github.io//tags/manifest">manifest</a>
        
            ,&nbsp;
            <a href="https://advincze.github.io//tags/presto">presto</a>
        
      </p>
       

      

    </div>
  </div>
</div>
    <footer class="footer">
      <div class="p2 wrap">
        <div class="measure mt1 center">
      <nav class="social-icons icons">
<a class="fa fa-rss rss" href="../../index.xml"></a>

<a class="fa fa-twitter twitter" href="https://twitter.com/advincze"></a>

</nav>

          <small>
            Copyright &#169; 2017<br>
            Powered by <a href="http://gohugo.io/" target="_blank">Hugo</a> &amp; <a href="https://github.com/azmelanar/hugo-theme-pixyll" target="_blank">Pixyll</a>
          </small>
        </div>
      </div>
    </footer>

    
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61034122-1', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>

